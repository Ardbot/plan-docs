# LLS протокол (python)
LLS протокол используется в промышлености и позволяет по RS-485 передавать данные с датчиков уровня топлива (уровень и температуру)
В качестве переходника используется конвертер rs-485->UART

## Подключение Умка310
Умка работает в режиме `master` и отправляет запросы на ведомые (`slave`) устройства.
Через переходник RS-485->UART приходят данные в последовательный порт (COM port):
![Alt text](/KnowledgeBase/images/lls.png)
Среди массива данных (`master`) можно выделить байты в 16-й системе счисления: <br>
`31 00 06 A8` 
* 31 - префикс, 
* 00 - адреса запрашиваемого устройства
* 06 - код операции ()
* A8 - контрольная сумма

### Команды (3-й байт):
|  Код  |                 Описание                 |                   Данные                    |
| :---: | :--------------------------------------: | :-----------------------------------------: |
|  06h  |      Однократное считывание данных       | Относительный уровень, температура, частота |
|  07h  |       Периодическая выдача данных        |
|  13h  | Изменение интервала периодической выдачи |                 От 0 до 255                 |
|   *   |                    *                     |                      *                      |
|  10h  |     Чтение текущих настроек датчика      |          Название, интервалы, ...           |


## Взаимодествие с микроконтролером

Преобразование строки в байты и обратно в массив байтов. Байты расположены согласно протоколу (префикс, адрес, код операции, ...)

Запрос: `31 01 06 6C` --> `b'1\x00\x06\xa8'` <br>
Ответ: `b'>\x00\x06\xe4\\>\x00\x00\xd2'` --> `3e0006e45c3e0000d2` --> `['3e', '00', '06', 'e4', '5c', '3e', '00', '00', 'd2']`

## Подсчет контрольной суммы
Просчет контрольной суммы производится табличным методом [Документация](https://doc.omnicomm.ru/ru/omnicomm_lls-integration/algorithm).<br>
Алгоритм для python и инструменты находятся в [скрипте](/scripts/LLSprotocol.py) 

## Возможность управления Умка310
Команда `CHAT X`, где Х является сообщением отправляет в скрипт `Х`. Скрипт отправляет данные по LLS. Управление через Интернет, BLE, СМС

## Источники:
* [Script](/scripts/LLSprotocol.py)
* [Видео](https://www.youtube.com/watch?v=pc8Wu1GhmnE)
* [Документация]()
* [Весовой контроллер (док.)](http://vesasystem.ru/f/prilozhenie_no3soobshcheniya_peredavaemye_po_shine_rs-485.pdf)

