# GeoServer

### Проект: [GeoServer](/)

### Ошибка

ВО время запуска geoserver проверить его статус. Если бекенд возращает 500 ошибку, то проверить путь к JDK и/или совместимость версий.

Как я устанавливал:
1. Установил java. Использовал 11 версию java `JRE`. Ссылка появится при установке Geoserver.
2. Установил Geoserver 2.24. Выбрал путь к java. Внимателенее смотрите на статус при выборе java. Он должен быть `VALID`. Режим запуска - ручной. С Автоматической сервер java не запускается (ошибка 500).
3. Путь к хранилищу данных лучше разместить на диски D (или т.п.)


# Добавить слой
Слои -> Добавить новый слой -> Добавить слой из (Хранилища) -> Выбор слоя -> Опубликовать -> Запоняем поля -> Меняем систему координат с EPSG:4326 на EPSG:3857 -> Преобразовать родную в объявленую -> Должно получиться приблизительно так:

`Родной охват`
Мин X 14 208; 
Мин Y 6 461;
Макс X ...;
Макс Y ...;

`Широта/долгота ограничивающего поля`
127, 50 ...

Сохраняем -> Просмотр слоёв -> OpenLayers-> видим наши контура без искажений. 

## Создание TMS (Tile Map Service)
В качестве клиента (Места отображения) буду использовать библиотеку Leaflet. 
необходима ссылка TMS. Для этого переходим на главную страницу [GeoServer](http://localhost:8080/) -> Находим `TMS 1.0.0`

В XML нас интересует url 'http://localhost:8080/geoserver/gwc/service/tms/1.0.0/Work%3ANameLayer@WebMercatorQuad@png'

Разберем url:<br>
`http://localhost:8080/geoserver` Наш сервер<br>
`gwc/service/tms/1.0.0/` TMS<br>
`Work` Имя рабочего пространства<br>
`NameLayer` Имя слоя<br>
`@WebMercatorQuad` Проекция. Может быть `EPSG:4326` или целевой `EPSG:3857`<br>
`@png` формат изображения. Пока нам не нужен<br>

Ссылка в текущем ввиде не пригодна для вставки в leaflet. 
Добавляем между проекцией и расширением координаты `/{z}/{x}/{y}.` Получаем ссылку: 
http://localhost:8080/geoserver/gwc/service/tms/1.0.0/Work%3ANameLayer@WebMercatorQuad/{z}/{x}/{y}.png' Будьте внимательнее, удостоверьтесь, что нет опечаток! 
При открытии ссылки в браузере отобразится 400 ошибка. Попробуйте поставить свои значения. к примеру `...WebMercatorQuad/3/6/5.png` TMS отдаст тайл (вероятно, пустой) или скажет, что за диапазоном. `/3/6/5` это координаты z, x, y в СК WebMercatorQuad (EPSG:3857)

При добавлении на Leaflet обязательно укажите опцию `tms`

Пример (React):
``` html
      <TileLayer
        url="http://localhost:8080/geoserver/gwc/service/tms/1.0.0/Work%3A3ANameLayer@WebMercatorQuad/{z}/{x}/{y}.png"    
        tms='true'
        attribution='geoserver'
      />
```

### Настройки GeoWebCache
Создает кеш тайловой плитки.
Кэшированные Геосетки по умолчанию
Тут по умолчанию можно добавить проекцию для TMS. При создании новых слоев, слой будет содержать необходимую систему координат (СК)

Кеш можно посмотреть в хранилище данных geoserver.